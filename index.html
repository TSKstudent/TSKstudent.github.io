--- START OF FILE index.html ---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Reality Research</title>
    <style>
        /* --- FONTS & IMPORTS --- */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap');

        :root {
            /* --- DYNAMIC VARIABLES --- */
            --primary: #3b82f6;       
            --secondary: #1d4ed8;     
            
            /* --- THEME MODES --- */
            --bg-color: #000000;
            --text-main: #e2e8f0;
            --text-dim: #94a3b8;
            --divider: rgba(59, 130, 246, 0.3); /* Subtle blue divider */
            --shadow-color: rgba(0, 0, 0, 1);
            
            --base-font-size: 1.15rem; 
        }

        body.light-mode {
            --bg-color: #f8fafc;
            --text-main: #0f172a;
            --text-dim: #475569;
            --divider: rgba(0, 0, 0, 0.1);
            --shadow-color: rgba(255, 255, 255, 0.8);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            height: 100vh;
            overflow: hidden;
            position: relative;
            transition: background-color 0.5s cubic-bezier(0.4, 0, 0.2, 1), color 0.5s ease;
        }

        /* --- BACKGROUND CANVAS --- */
        #canvas-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* --- INTERFACE WRAPPER --- */
        .interface-wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            max-width: 1000px;
            height: 80vh;
            z-index: 10;
            display: flex;
            flex-direction: column;
            pointer-events: none; 
        }

        .floating-container {
            pointer-events: auto;
            background: transparent;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            text-shadow: 0 2px 4px var(--shadow-color);
            animation: fadeIn 1.5s ease-out forwards;
        }

        /* --- TABS --- */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--divider);
            margin-bottom: 30px;
            padding-bottom: 10px;
            transition: border-color 0.5s;
        }

        .tab-btn {
            margin-right: 30px;
            background: transparent;
            border: none;
            color: var(--text-dim);
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            padding: 5px 0;
            transform-origin: center;
        }

        .tab-btn:hover {
            color: var(--text-main);
            transform: scale(1.05);
        }

        .tab-btn.active {
            color: var(--primary);
            transform: scale(1.05);
            text-shadow: 0 0 15px var(--primary);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -11px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
            box-shadow: 0 0 15px var(--primary);
            animation: expandLine 0.4s ease-out forwards;
        }

        /* --- CONTENT AREA --- */
        .content-viewport {
            flex: 1;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 15px;
        }

        .tab-content {
            display: none;
            width: 100%;
        }

        .tab-content.active {
            display: block;
            animation: slideFadeIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        .tab-content.exiting {
            display: block;
            animation: slideFadeOut 0.3s ease-in forwards;
            position: absolute;
            top: 0;
            width: 100%;
        }

        /* --- TYPOGRAPHY --- */
        p {
            margin-bottom: 25px;
            line-height: 1.9;
            font-size: var(--base-font-size);
            text-align: justify;
            color: var(--text-main);
            transition: font-size 0.2s ease, color 0.5s ease;
        }

        .apa-citation {
            margin-bottom: 25px;
            padding-left: 20px;
            border-left: 1px solid var(--secondary);
            font-size: calc(var(--base-font-size) * 0.95);
            color: var(--text-dim);
            transition: all 0.3s ease;
            cursor: default;
        }

        .apa-citation:hover {
            border-left-color: var(--primary);
            padding-left: 25px;
            color: var(--text-main);
        }

        .apa-citation a {
            color: var(--primary);
            text-decoration: none;
            word-break: break-all;
            display: block;
            margin-top: 5px;
            font-size: 0.9em;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .apa-citation a:hover {
            opacity: 1;
            text-decoration: underline;
            text-shadow: 0 0 8px var(--primary);
        }

        /* --- SETTINGS STYLING --- */
        .settings-section {
            margin-bottom: 40px;
        }

        .settings-section h3 {
            font-family: 'Orbitron', sans-serif;
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 1.1rem;
            border-bottom: 1px solid var(--divider);
            padding-bottom: 10px;
            opacity: 0.9;
            text-shadow: 0 0 10px rgba(var(--primary), 0.4);
        }

        .control-row {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            gap: 20px;
            flex-wrap: wrap;
            transition: opacity 0.3s;
            padding-left: 5px;
        }

        .control-row.disabled {
            opacity: 0.4;
            pointer-events: none;
        }

        .control-label {
            width: 150px;
            font-size: 1rem;
            color: var(--text-main);
            font-weight: 500;
        }

        select {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--text-dim);
            padding: 8px 12px;
            border-radius: 4px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            outline: none;
            transition: all 0.3s;
        }
        
        select:hover {
            border-color: var(--primary);
            text-shadow: 0 0 5px var(--primary);
        }
        
        option {
            background: var(--bg-color);
            color: var(--text-main);
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            max-width: 250px;
            background: transparent;
            height: 30px;
            cursor: pointer;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: var(--text-dim);
            border-radius: 2px;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: var(--primary);
            margin-top: -7px;
            box-shadow: 0 0 5px var(--primary);
            border: 2px solid var(--bg-color);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 46px;
            height: 24px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        
        .slider-toggle {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--text-dim);
            transition: .4s;
            border-radius: 34px;
            opacity: 0.5;
        }
        
        .slider-toggle:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider-toggle { 
            background-color: var(--primary); 
            opacity: 1;
        }
        
        input:checked + .slider-toggle:before { 
            transform: translateX(22px); 
        }

        .text-preview {
            margin-left: 15px;
            color: var(--primary);
            font-size: var(--base-font-size); 
            opacity: 0.9;
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--text-dim); border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideFadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideFadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-15px); } }
        @keyframes expandLine { from { width: 0; left: 50%; } to { width: 100%; left: 0; } }

        @media (max-width: 768px) {
            .interface-wrapper { width: 95%; height: 90vh; }
            .control-row { flex-direction: column; align-items: flex-start; gap: 10px; }
        }
    </style>
</head>
<body>

    <canvas id="canvas-bg"></canvas>

    <div class="interface-wrapper">
        <div class="floating-container">
            <div class="tabs">
                <button id="btn-research" class="tab-btn active" onclick="switchTab('research')">Research</button>
                <button id="btn-sources" class="tab-btn" onclick="switchTab('sources')">Sources</button>
                <button id="btn-settings" class="tab-btn" onclick="switchTab('settings')">Settings</button>
            </div>

            <div class="content-viewport" id="scroll-container">
                <!-- Tab 1: Research -->
                <div id="research" class="tab-content active">
                    <p>Don’t use your phone in a dark room. Don’t put your phone too close to your face. Don’t use your phone while walking. I’m sure your parents have said this to you before, or you may have said it to someone else before. But what if I were to tell you that there is something that throws all these guidelines to the sidelines, an item that is an inch from your eyes, sealed to allow no light in, and requires vigorous movements and even walking to operate.</p>
                    <p>Virtual reality may seem like a sophisticated new technology, but it only gained widespread recognition after the success of the Oculus Rift in 2013. Before that, virtual reality was just an idea that was too ahead of its time. The concept of virtual reality originated in the 1930s with the book “Pygmalion’s Spectacles” by science fiction writer Stanley G. Weinbaum. However, the first virtual reality headset was not created until 20 years later, in the 1950s, utilising large and bulky CRT (Cathode Ray Tube) displays. Virtual reality has come a long way, now using state-of-the-art retina-level OLED (Organic Light-Emitting Diode) displays. The ability to interact with that virtual world had also vastly improved, being able to not only see and hear, but even feel using a multitude of different methods, using controllers, treadmills, hand and leg tracking, even eye and mouth tracking. But on top of all that, the sensory experience has improved leaps and bounds, too, now being able to see, hear, and even feel and smell through new technology like haptic feedback or electric stimulation. However, with all these new advancements, it only makes turning this virtual world into your main one more enticing.</p>
                    <p>Now you may think, what’s wrong with having a little fun? It’s just another way of entertaining ourselves. And you are right. But don’t you know? Social media addiction, gaming addictions, brain rot. Virtual reality is precisely that, wait, never mind, it’s not. It’s worse. Now, not only are you just sitting and using your computer at a desk, or using your phone on your bed, you are isolating yourself from the world, unable to even tell the time, too distracted to realise you’re hungry, too engaged with virtual characters to talk to real people. And that is the first of many problems with virtual reality. Addiction. A seemingly common problem with any new technology these days, and the root of many of the other problems listed later. Virtual reality brings the seven deadly sins straight to your doorstep, letting you do whatever you want with your own hands, without any repercussions. But what are the practical effects of addiction?</p>
                    <p>Let’s start with the social problems. By becoming addicted to this virtual world, real life can become dull after slaying dragons, talking to family members can feel like a chore after talking to the president, and this can cause people to isolate themselves in this virtual world, as it seems like the only one worth living in. This might cause people to withdraw and stop interacting with others in real life, or lead to a change in character as their role-playing becomes too extreme. But it’s not all bad. Virtual reality can also be a valuable and helpful tool. It has been used in prisons for rehabilitation, hospitals for surgery training or physical therapy, and even at home by people who suffer from mutism, using social games like VRChat to learn how to interact with others. After talking about mentally, what about physically? At the start of this [insert name of deliverable], I listed out the things your parents always tell you or what you may always tell others what not to do. Since virtual reality headsets contradict many of those guidelines, do they really impact your health? Generally speaking, excessive screen time can cause dry eyes and headaches. While irritating, this typically doesn't cause lasting harm or damage to your vision in the long term. This is also true for what we currently know about the blue light emitted from screens; it may disrupt your sleep, but research so far hasn't shown it's enough to damage your vision or have a negative impact on eye health. Based on recent studies, virtual reality also does not cause any adverse long-term effects on a child’s cognitive or visual abilities, with effects similar to those of typical devices.</p>
                    <p>Finally, what about the economic impact of this industry? Unbeknownst to most, one of the largest virtual reality companies, Meta, has lost a staggering S$94.3 billion since launching its virtual reality department. Despite the apparent success of virtual reality headsets like the PSVR, paving the way for a successor, the PSVR2, as well as well-received headsets like the big screen beyond two and its prequel, the virtual reality market has not exactly been very profitable. Despite this, big players like Apple, Google and Samsung have been hard at work, haemorrhaging money to develop new groundbreaking headsets like the Apple Vision Pro and Galaxy XR (Previously known as Project Moohan), pushing the limits of what’s possible. Pimax, an independent virtual reality headset producer based in Shanghai, has also raised S$16.79 million from investors, along with other bullish trends from investors, thus proving that, despite the grim signs, many still believe that virtual reality is not a lost cause.</p>
                    <p>All in all, virtual reality is a new and rapidly evolving technology with a past longer than expected, just like Artificial Intelligence. And that’s not the only similarity between them; both are also industries haemorrhaging money, and both are scrutinised by some to be a bubble. These two industries share a lot in common. And just like the AI industry, I believe that virtual reality will have its time to shine again. With the rise of augmented reality, because of shifts from major companies like Meta and Google, it is likely that virtual reality may not be in the spotlight, but that does not mean it is dead. Despite its various shortcomings, virtual reality also offers a plethora of benefits that can be reaped. But until the day NerveGear becomes real, I doubt it will ever be in the spotlight of our ever-changing and ever-evolving world again.</p>
                </div>

                <!-- Tab 2: Sources -->
                <div id="sources" class="tab-content">
                    <div class="apa-citation">
                        BCC Research. (n.d.). <i>The history and evolution of virtual reality technology</i>. <a href="https://blog.bccresearch.com/the-history-and-evolution-of-virtual-reality-technology" target="_blank">https://blog.bccresearch.com/the-history-and-evolution-of-virtual-reality-technology</a>
                    </div>
                    <div class="apa-citation">
                        Skarbez, R., Smith, M., & Whitton, M. C. (2021). Revisiting Milgram and Kishino's Reality-Virtuality Continuum. <i>Frontiers in Virtual Reality, 2</i>. <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC9517547/" target="_blank">https://pmc.ncbi.nlm.nih.gov/articles/PMC9517547/</a>
                    </div>
                    <div class="apa-citation">
                        TechRadar. (2016). <i>Forgotten genius: The man who made a working VR machine in 1957</i>. <a href="https://www.techradar.com/news/wearables/forgotten-genius-the-man-who-made-a-working-vr-machine-in-1957-1318253/2" target="_blank">https://www.techradar.com/news/wearables/forgotten-genius-the-man-who-made-a-working-vr-machine-in-1957-1318253/2</a>
                    </div>
                    <div class="apa-citation">
                        YouTube. (n.d.). <i>[Video title unavailable]</i>. <a href="https://www.youtube.com/watch?v=UW8NapTA9o" target="_blank">https://www.youtube.com/watch?v=UW8NapTA9o</a>
                    </div>
                    <div class="apa-citation">
                        The Guardian. (2025, March 8). <i>VR prison California</i>. <a href="https://www.theguardian.com/technology/2025/mar/08/vr-prison-california" target="_blank">https://www.theguardian.com/technology/2025/mar/08/vr-prison-california</a>
                    </div>
                    <div class="apa-citation">
                        Information Technology and Innovation Foundation. (2025, June 2). <i>AR/VR's potential in health care</i>. <a href="https://itif.org/publications/2025/06/02/arvrs-potential-in-health-care/" target="_blank">https://itif.org/publications/2025/06/02/arvrs-potential-in-health-care/</a>
                    </div>
                    <div class="apa-citation">
                        CNET. (n.d.). <i>Is VR bad for your eyes? Here's what eye doctors say</i>. <a href="https://www.cnet.com/health/medical/is-vr-bad-for-your-eyes-heres-what-eye-doctors-say/" target="_blank">https://www.cnet.com/health/medical/is-vr-bad-for-your-eyes-heres-what-eye-doctors-say/</a>
                    </div>
                    <div class="apa-citation">
                        Frontiers in Virtual Reality. (2025). <i>Article Title from Volume 10.3389</i>. <a href="https://www.frontiersin.org/journals/virtual-reality/articles/10.3389/frvir.2025.1547198/full" target="_blank">https://www.frontiersin.org/journals/virtual-reality/articles/10.3389/frvir.2025.1547198/full</a>
                    </div>
                    <div class="apa-citation">
                        Yahoo Finance. (n.d.). <i>Meta Platforms lost $73 billion</i>. <a href="https://finance.yahoo.com/news/meta-platforms-lost-73-billion-165823364.html" target="_blank">https://finance.yahoo.com/news/meta-platforms-lost-73-billion-165823364.html</a>
                    </div>
                    <div class="apa-citation">
                        Road to VR. (n.d.). <i>Pimax raises $13m to accelerate R&D of PC VR headsets in US and Europe</i>. <a href="https://www.roadtovr.com/pimax-raises-13m-accelerate-r-d-pc-vr-headsets-us-europe/" target="_blank">https://www.roadtovr.com/pimax-raises-13m-accelerate-r-d-pc-vr-headsets-us-europe/</a>
                    </div>
                </div>

                <!-- Tab 3: Settings -->
                <div id="settings" class="tab-content">
                    <div class="settings-section">
                        <h3>Interface</h3>
                        <div class="control-row">
                            <span class="control-label">Theme Mode</span>
                            <label class="switch">
                                <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
                                <span class="slider-toggle"></span>
                            </label>
                            <span id="themeLabel" style="font-size: 0.9rem; color: var(--text-dim); width: 50px; margin-left: 10px;">Dark</span>
                        </div>
                        <div class="control-row">
                            <span class="control-label">Color Theme</span>
                            <select id="colorSelect" onchange="changeColorTheme(this.value)">
                                <option value="blue" selected>Royal Blue</option>
                                <option value="cyan">Retro Cyan</option>
                                <option value="green">Emerald Green</option>
                                <option value="red">Crimson Red</option>
                                <option value="purple">Neon Purple</option>
                            </select>
                        </div>
                        <div class="control-row">
                            <span class="control-label">Text Size</span>
                            <input type="range" class="expressive-slider" min="0.8" max="1.6" step="0.05" value="1.15" oninput="updateFontSize(this.value)">
                            <span class="text-preview">Preview 123</span>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Visuals</h3>
                        <div class="control-row">
                            <span class="control-label">Motion Speed</span>
                            <input type="range" class="expressive-slider" min="0.1" max="2.0" step="0.1" value="1.0" oninput="updateSpeed(this.value)">
                        </div>
                        <div class="control-row">
                            <span class="control-label">Particle Count</span>
                            <input type="range" class="expressive-slider" min="0" max="300" step="10" value="100" oninput="updateParticleCount(this.value)">
                            <span id="countLabel" style="font-size: 0.9rem; color: var(--text-dim); margin-left: 10px;">100</span>
                        </div>
                        <div class="control-row">
                            <span class="control-label">Show Dots</span>
                            <label class="switch">
                                <input type="checkbox" id="dotsToggle" checked onchange="toggleDots(this.checked)">
                                <span class="slider-toggle"></span>
                            </label>
                        </div>
                        <div class="control-row" id="linesRow">
                            <span class="control-label">Show Lines</span>
                            <label class="switch">
                                <input type="checkbox" id="linesToggle" checked onchange="toggleLines(this.checked)">
                                <span class="slider-toggle"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* --- TAB LOGIC --- */
        let isAnimating = false;
        function switchTab(targetId) {
            if (isAnimating) return;
            const targetContent = document.getElementById(targetId);
            const currentContent = document.querySelector('.tab-content.active');
            if (currentContent && currentContent.id === targetId) return;

            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + targetId).classList.add('active');
            isAnimating = true;

            if (currentContent) {
                currentContent.classList.remove('active');
                currentContent.classList.add('exiting');
                setTimeout(() => {
                    currentContent.classList.remove('exiting');
                    targetContent.classList.add('active');
                    isAnimating = false;
                }, 300); 
            } else {
                targetContent.classList.add('active');
                isAnimating = false;
            }
        }

        /* --- SETTINGS LOGIC --- */
        function toggleTheme() {
            const body = document.body;
            body.classList.toggle('light-mode');
            const label = document.getElementById('themeLabel');
            label.innerText = body.classList.contains('light-mode') ? "Light" : "Dark";
        }

        function changeColorTheme(val) {
            const r = document.documentElement;
            switch(val) {
                case 'blue':   r.style.setProperty('--primary', '#3b82f6'); r.style.setProperty('--secondary', '#1d4ed8'); break;
                case 'cyan':   r.style.setProperty('--primary', '#06b6d4'); r.style.setProperty('--secondary', '#0e7490'); break;
                case 'green':  r.style.setProperty('--primary', '#10b981'); r.style.setProperty('--secondary', '#047857'); break;
                case 'red':    r.style.setProperty('--primary', '#ef4444'); r.style.setProperty('--secondary', '#b91c1c'); break;
                case 'purple': r.style.setProperty('--primary', '#d946ef'); r.style.setProperty('--secondary', '#a21caf'); break;
            }
            updateSliderBackgrounds();
        }

        function updateFontSize(val) {
            document.documentElement.style.setProperty('--base-font-size', val + 'rem');
        }

        /* --- VISUAL CONFIG --- */
        let globalSpeedFactor = 1.0;
        let targetParticleCount = 100;
        let showDots = true;
        let showLines = true;

        function updateSpeed(val) { globalSpeedFactor = parseFloat(val); }
        function updateParticleCount(val) { 
            targetParticleCount = parseInt(val); 
            document.getElementById('countLabel').innerText = val;
            initParticles(); 
        }
        function toggleDots(val) { 
            showDots = val; 
            const linesToggle = document.getElementById('linesToggle');
            const linesRow = document.getElementById('linesRow');
            if (!val) {
                showLines = false;
                linesToggle.checked = false;
                linesToggle.disabled = true;
                linesRow.classList.add('disabled');
            } else {
                linesToggle.disabled = false;
                linesRow.classList.remove('disabled');
            }
        }
        function toggleLines(val) { showLines = val; }

        function updateSliderBackgrounds() {
            const sliders = document.querySelectorAll('input[type=range]');
            const style = getComputedStyle(document.documentElement);
            const primary = style.getPropertyValue('--primary').trim();
            const bg = style.getPropertyValue('--text-dim').trim();
            sliders.forEach(slider => {
                const val = (slider.value - slider.min) / (slider.max - slider.min) * 100;
                slider.style.background = `linear-gradient(to right, ${primary} 0%, ${primary} ${val}%, ${bg} ${val}%, ${bg} 100%)`;
                slider.style.height = '4px';
                slider.style.borderRadius = '2px';
            });
        }
        document.querySelectorAll('input[type=range]').forEach(el => el.addEventListener('input', updateSliderBackgrounds));
        setTimeout(updateSliderBackgrounds, 100);

        /* --- PARTICLE SYSTEM (SCROLL-AWARE) --- */
        const canvas = document.getElementById("canvas-bg");
        const ctx = canvas.getContext("2d");
        const scrollContainer = document.getElementById("scroll-container");

        let width, height;
        let particles = [];
        const connectionDistance = 150;
        const mouseRadius = 250; 
        let mouse = { x: -1000, y: -1000, isDown: false };
        
        // Scroll tracking variables
        let lastScrollTop = 0;
        let scrollDelta = 0;

        window.addEventListener('mousemove', (e) => { mouse.x = e.clientX; mouse.y = e.clientY; });
        window.addEventListener('mousedown', () => { mouse.isDown = true; });
        window.addEventListener('mouseup', () => { mouse.isDown = false; });

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        function hexToRgb(hex) {
            var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            hex = hex.replace(shorthandRegex, (m, r, g, b) => r + r + g + g + b + b);
            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : { r: 59, g: 130, b: 246 };
        }

        class Particle {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.baseVx = (Math.random() - 0.5) * 0.5;
                this.baseVy = (Math.random() - 0.5) * 0.5;
                this.momVx = 0;
                this.momVy = 0;
                this.size = Math.random() * 2 + 1;
            }

            update(sDelta) {
                // Apply standard movement
                this.x += this.baseVx * globalSpeedFactor;
                this.y += this.baseVy * globalSpeedFactor;
                this.x += this.momVx;
                this.y += this.momVy;

                // Apply Scroll Displacement (Move dots up when scrolling down)
                this.y -= sDelta;

                this.momVx *= 0.92;
                this.momVy *= 0.92;

                // Horizontal wrapping
                if (this.x < 0) this.x = width;
                if (this.x > width) this.x = 0;

                // Vertical wrapping (The "Replacement" logic)
                // If a dot goes off the top, it reappears at the bottom with a new X
                if (this.y < -20) {
                    this.y = height + 20;
                    this.x = Math.random() * width;
                } else if (this.y > height + 20) {
                    this.y = -20;
                    this.x = Math.random() * width;
                }

                let dx = mouse.x - this.x;
                let dy = mouse.y - this.y;
                let distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < mouseRadius && mouse.isDown) {
                    const force = (mouseRadius - distance) / mouseRadius;
                    this.momVx -= (dx / distance) * force * 2.0;
                    this.momVy -= (dy / distance) * force * 2.0;
                }
            }

            draw(rgb) {
                if (!showDots) return;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.6)`;
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            for (let i = 0; i < targetParticleCount; i++) particles.push(new Particle());
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);
            
            // Calculate scroll delta for this frame
            const currentScrollTop = scrollContainer.scrollTop;
            scrollDelta = currentScrollTop - lastScrollTop;
            lastScrollTop = currentScrollTop;

            const style = getComputedStyle(document.documentElement);
            const rgb = hexToRgb(style.getPropertyValue('--primary').trim());

            particles.forEach((p, index) => {
                p.update(scrollDelta);
                p.draw(rgb);

                if (!showLines) return;
                for (let j = index + 1; j < particles.length; j++) {
                    const p2 = particles[j];
                    const dx = p.x - p2.x;
                    const dy = p.y - p2.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist < connectionDistance) {
                        let opacity = 1 - dist / connectionDistance;
                        const mDx = mouse.x - p.x;
                        const mDy = mouse.y - p.y;
                        const mDist = Math.sqrt(mDx*mDx + mDy*mDy);

                        if (mouse.isDown && mDist < mouseRadius) {
                            ctx.strokeStyle = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${opacity * 0.9})`; 
                            ctx.lineWidth = 1.2; 
                        } else {
                            ctx.strokeStyle = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${opacity * (mDist < mouseRadius ? 0.6 : 0.25)})`;
                            ctx.lineWidth = mDist < mouseRadius ? 0.8 : 0.5;
                        }
                        ctx.beginPath();
                        ctx.moveTo(p.x, p.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.stroke();
                    }
                }
            });
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => { resize(); initParticles(); });
        resize();
        initParticles();
        animate();
    </script>
</body>
</html>